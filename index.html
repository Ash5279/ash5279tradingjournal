<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Trading Journal Calendar</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f4f6f8;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
      color: #333;
    }

    #input-section {
      background: white;
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 30px;
    }

    input, select, button {
      padding: 8px;
      font-size: 14px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    button {
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }

    #calendar-container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    #month-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    #month-name {
      font-size: 1.5em;
      font-weight: bold;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
    }

    .weekday-header {
      font-weight: bold;
      text-align: center;
      padding: 6px;
      border-bottom: 2px solid #e0e0e0;
    }

    .day-cell {
      background-color: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      text-align: center;
      font-size: 14px;
      cursor: pointer;
      min-height: 60px;
    }

    .profit { background-color: #d4edda; }
    .loss { background-color: #f8d7da; }
    .neutral { background-color: #f0f0f0; }

    #summary-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      border: 2px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      padding: 20px;
      z-index: 1000;
      max-width: 300px;
    }

    #yearly-summary {
      max-width: 1200px;
      margin: 40px auto 0;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }

    .monthly-summary {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      flex: 3;
    }

    .month-block {
      width: 100px;
      padding: 12px;
      text-align: center;
      border-radius: 6px;
      color: white;
      cursor: default;
      position: relative;
      white-space: pre-line;
      font-weight: bold;
    }

    .month-block.profit { background-color: #28a745; }
    .month-block.loss { background-color: #dc3545; }
    .month-block.neutral { background-color: #6c757d; }

    .right-panel {
      flex: 1;
      min-width: 220px;
      border-left: 1px solid #ddd;
      padding-left: 20px;
    }

    .stats-box {
      background: #f9f9f9;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    .stats-box h3 {
      margin-top: 0;
      font-size: 1.2em;
    }

    .stats-box p {
      margin: 8px 0;
      font-size: 14px;
      display: flex;
      justify-content: space-between;
    }

    .yearly-total {
      text-align: center;
      font-size: 1.2em;
      padding: 15px;
      border-top: 2px solid #ccc;
      background: #f1f1f1;
      border-radius: 8px;
      font-weight: bold;
      margin-top: 20px;
      flex-basis: 100%;
    }
  </style>
</head>
<body>

  <h1>Trading Journal Calendar</h1>

  <div id="input-section">
    <label for="date">Date:</label>
    <input type="date" id="date">
    <label for="pair">Trade Pair:</label>
    <input type="text" id="pair" placeholder="e.g., EUR/USD">
    <label for="profitLoss">Profit/Loss:</label>
    <input type="number" id="profitLoss">
    <label for="category">Category:</label>
    <select id="category">
      <option value="Forex">Forex</option>
      <option value="Stocks">Stocks</option>
      <option value="Crypto">Crypto</option>
      <option value="Other">Other</option>
    </select>
    <button onclick="addEntry()">Add Trade</button>
  </div>

  <div id="calendar-container">
    <div id="month-navigation">
      <button onclick="changeMonth(-1)">‚Üê Previous</button>
      <div id="month-name"></div>
      <button onclick="changeMonth(1)">Next ‚Üí</button>
    </div>

    <div class="grid" id="weekday-headers">
      <div class="weekday-header">Mon</div>
      <div class="weekday-header">Tue</div>
      <div class="weekday-header">Wed</div>
      <div class="weekday-header">Thu</div>
      <div class="weekday-header">Fri</div>
      <div class="weekday-header">Sat</div>
      <div class="weekday-header">Sun</div>
    </div>

    <div class="grid" id="calendar"></div>
  </div>

  <div id="yearly-summary">
    <div class="monthly-summary" id="monthly-summary"></div>
    <div class="right-panel">
      <div class="stats-box" id="yearly-stats">
        <h3>üìä Trade Stats</h3>
        <p>üì¶ Total Trades: <span id="total-trades">0</span></p>
        <p>‚úÖ Wins: <span id="wins">0</span></p>
        <p>‚ùå Losses: <span id="losses">0</span></p>
        <p>üìà Win Rate: <span id="win-rate">0%</span></p>
      </div>
    </div>
    <div class="yearly-total" id="yearly-total">Yearly Net P/L: $0.00</div>
  </div>

  <script>
    const calendar = document.getElementById('calendar');
    const monthName = document.getElementById('month-name');
    const monthlySummaryDiv = document.getElementById('monthly-summary');
    const yearlyTotalDiv = document.getElementById('yearly-total');
    const entries = {};
    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();

    function updateMonthName() {
      const date = new Date(currentYear, currentMonth);
      monthName.textContent = date.toLocaleString('default', { month: 'long', year: 'numeric' });
    }

    function changeMonth(direction) {
      currentMonth += direction;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      } else if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      generateCalendar();
    }

    function generateCalendar() {
      calendar.innerHTML = '';
      updateMonthName();

      const firstDay = new Date(currentYear, currentMonth, 1);
      const startDay = (firstDay.getDay() + 6) % 7;
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

      for (let i = 0; i < startDay; i++) {
        const empty = document.createElement('div');
        calendar.appendChild(empty);
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const trades = entries[dateStr] || [];
        const net = trades.reduce((sum, t) => sum + t.profitLoss, 0);

        const cell = document.createElement('div');
        cell.className = 'day-cell';
        cell.innerHTML = `<strong>${day}</strong><br>${net.toFixed(2)}`;
        cell.onclick = () => updateDailySummary(dateStr);

        if (net > 0) cell.classList.add('profit');
        else if (net < 0) cell.classList.add('loss');
        else cell.classList.add('neutral');

        calendar.appendChild(cell);
      }

      updateYearlySummary();
    }

    function addEntry() {
      const date = document.getElementById('date').value;
      const tradePair = document.getElementById('pair').value;
      const profitLoss = parseFloat(document.getElementById('profitLoss').value);
      const category = document.getElementById('category').value;

      if (date && tradePair && !isNaN(profitLoss)) {
        if (!entries[date]) entries[date] = [];
        entries[date].push({
          tradePair,
          profitLoss,
          category,
          lotsUsed: Math.random() * 5
        });
        generateCalendar();
      } else {
        alert('Please fill in all fields correctly.');
      }
    }

    function updateDailySummary(date) {
      const existing = document.getElementById('summary-popup');
      if (existing && existing.dataset.active === date) {
        existing.remove();
        return;
      }
      if (existing) existing.remove();

      const trades = entries[date] || [];
      const net = trades.reduce((sum, t) => sum + t.profitLoss, 0);
      const totalLots = trades.reduce((sum, t) => sum + t.lotsUsed, 0);
      const wins = trades.filter(t => t.profitLoss > 0).length;
      const losses = trades.filter(t => t.profitLoss < 0).length;
      const winRate = trades.length ? ((wins / trades.length) * 100).toFixed(1) : '0.0';

      const popup = document.createElement('div');
      popup.id = 'summary-popup';
      popup.dataset.active = date;
      popup.innerHTML = `
        <p><strong>üìÖ ${date}</strong></p>
        <p>üíπ Trades Taken: ${trades.length}</p>
        <p>‚úÖ Wins: ${wins}</p>
        <p>‚ùå Losses: ${losses}</p>
        <p>üìä Total Lots Used: ${totalLots.toFixed(2)}</p>
        <p>üí∞ Net Profit: ${net >= 0 ? '+' : ''}$${net.toFixed(2)}</p>
        <p>üìà Win Rate: ${winRate}%</p>
        <hr>
        <p><strong>Trade Details:</strong></p>
        <ul>
          ${trades.map(t => `<li><strong>${t.tradePair}</strong> ‚Äî ${t.lotsUsed.toFixed(2)} Lot ‚Äî ${t.profitLoss >= 0 ? '+' : ''}$${t.profitLoss.toFixed(2)}</li>`).join('')}
        </ul>
      `;

      document.body.appendChild(popup);

      const listener = (e) => {
        if (!popup.contains(e.target)) {
          popup.remove();
          document.removeEventListener('click', listener);
        }
      };
      setTimeout(() => {
        document.addEventListener('click', listener);
      }, 0);
    }

    function updateYearlySummary() {
      const months = Array(12).fill(0);
      let yearlyTotal = 0, totalTrades = 0, wins = 0, losses = 0;

      for (const date in entries) {
        const [year, month] = date.split('-');
        if (+year === currentYear) {
          const trades = entries[date];
          const net = trades.reduce((sum, t) => sum + t.profitLoss, 0);
          months[+month - 1] += net;
          yearlyTotal += net;
          totalTrades += trades.length;
          wins += trades.filter(t => t.profitLoss > 0).length;
          losses += trades.filter(t => t.profitLoss < 0).length;
        }
      }

      monthlySummaryDiv.innerHTML = '';
      months.forEach((val, i) => {
        const div = document.createElement('div');
        div.className = `month-block ${val > 0 ? 'profit' : val < 0 ? 'loss' : 'neutral'}`;
        div.textContent = `${new Date(0, i).toLocaleString('default', { month: 'short' })}\n${val.toFixed(2)}`;
        monthlySummaryDiv.appendChild(div);
      });

      const winRate = totalTrades ? ((wins / totalTrades) * 100).toFixed(1) + '%' : '0%';
      document.getElementById('total-trades').textContent = totalTrades;
      document.getElementById('wins').textContent = wins;
      document.getElementById('losses').textContent = losses;
      document.getElementById('win-rate').textContent = winRate;

      yearlyTotalDiv.textContent = `Yearly Net P/L: ${yearlyTotal >= 0 ? '+' : ''}$${yearlyTotal.toFixed(2)}`;
    }

    generateCalendar();
  </script>
</body>
</html>
